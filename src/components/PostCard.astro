---
import { Image } from 'astro:assets';
import FormattedDate from './FormattedDate.astro';
import { ui, defaultLang } from '../i18n/ui';

export interface Props {
  post: any;
  number: string;
}

const { post, number } = Astro.props;

function getLangFromId(id: string) {
	const [lang] = id.split('/');
	if (lang in ui) return lang as keyof typeof ui;
	return defaultLang;
}

const lang = getLangFromId(post.id);
const t = ui[lang];
const categoriesSlug = t['nav.categories.slug'];

// Função para obter o nome e slug traduzido de uma tag
function getTranslatedTag(tagKey: string) {
    const name = t[`tags.${tagKey}.name`] || tagKey;
    const slug = t[`tags.${tagKey}.slug`] || tagKey;
    return { name, slug };
}
---

<!-- Componente de Card para Post -->
<li>
  <div class="card">
    <a href={`/blog/${post.id}/`}>
      <span class="post-label">{number}</span>
      {post.data.ads && <span class="post-label is-ad">ads</span>}
      {post.data.heroImage && (
        <Image width={720} height={360} src={post.data.heroImage} alt="" />
      )}
      <div class="content">
        <h4 class="title">{post.data.title}</h4>
        <p class="description">{post.data.description}</p>
        <p class="date">
          <FormattedDate date={post.data.pubDate} />
        </p>
      </div>
    </a>
    {post.data.tags && (
      <div class="tags">
        {post.data.tags.map((tagKey) => {
          const translatedTag = getTranslatedTag(tagKey);
          return (
            <a href={`/${lang}/${categoriesSlug}/${translatedTag.slug}/`} class="tag">
              #{translatedTag.name}
            </a>
          )
        })}
      </div>
    )}
  </div>
</li>

<style>
  li {
    position: relative;
    list-style-type: none;
    display: flex;
    flex-direction: column;
  }

  .card {
    height: 100%;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  .card > a {
    text-decoration: none;
    flex-grow: 1;
  }

  .card > a:hover .title,
  .card > a:hover .description,
  .card > a:hover .date {
    color: var(--green-bright);
  }

  .card > a:hover img {
    box-shadow: var(--box-shadow);
  }

  li .post-label.is-ad {
    background-color: #ffd700; /* Cor dourada */
    left: unset;
    right: -0.75rem;
  }

  img {
    width: 100%;
    aspect-ratio: 2 / 1;
    object-fit: cover;
    margin-bottom: 0.5rem;
    border-radius: 12px;
    transition: 0.2s ease;
  }

  .content {
    padding: 0 1rem;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }
  
  .content p {
    flex-grow: 1;
  }

  .title {
    margin: 0;
    color: rgb(var(--black));
    line-height: 1;
  }

  .date {
    margin: 0;
    color: rgb(var(--black));
  }

  .description {
    margin: 0.5rem 0 0;
    color: rgb(var(--gray-dark));
    font-size: 0.9rem;
  }

  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
    padding: 0 1rem;
  }

  .tag {
    font-size: 0.9rem;
    color: rgb(var(--black));
    background-color: transparent;
    padding: 0;
    border: none;
    text-decoration: none;
	margin-right: 0.5rem; /* Garante o espaçamento */
  }

  .tag:hover {
    color: var(--green-bright);
  }
</style>
